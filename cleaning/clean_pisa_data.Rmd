---
title: "Clean PISA Data"
output:
  html_document:
    df_print: paged
    keep_md: yes
    toc: yes
---

## Introduction

### Goal

The Goal of this File is to clean the Data of the PISA (Programm for International Student Assessment) study in order  
to use it for comparing with the World Happiness Record and the GISAH Study.
  
The cleaned Data should contain the Scores for the different PISA Scales for the year 2015 in different columns.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Load Librarys

-- Load Library for reading CSV Files.
-- Load tidyr-library

```{r eval=FALSE, echo=TRUE}
library(csvread)
library(tidyr)
```


### Read PISA - CSV File

-- Read CSV File "pisa_data.csv"  
-- Gets PISA Data for cleaning


```{r eval=TRUE, echo=TRUE}
pisadata_dirty <- read.csv(file = "../data/raw_data/pisa_data.csv", header = TRUE)
pisadata_dirty
```

## Clean Data

### Delete unneccessary columns and rows

-- Delete not needed rows  
-- Rename colums  
-- Delete not needed colums  
  -- Columns with scores for the years 2013 and 2015 are not needed  

```{r eval=TRUE, echo=TRUE}
tail(pisadata_dirty)
n<-dim(pisadata_dirty)[1]
pisadata_dirty<-pisadata_dirty[1:(n-5),]
tail(pisadata_dirty)

names(pisadata_dirty)
names(pisadata_dirty)[1] <- "Country"
names(pisadata_dirty)[5] <- "Score.2013"
names(pisadata_dirty)[6] <- "Score.2014"
names(pisadata_dirty)[7] <- "Score.2015"
names(pisadata_dirty)

drops <- c("Country.Code","Series.Code", "Score.2013", "Score.2014")
pisadata_dirty <- pisadata_dirty[ , !(names(pisadata_dirty) %in% drops)]
head(pisadata_dirty)
```

### Apart the different PISA-Categorys

-- Apart the Mean Performance of the different Scales 
-- Delete the unneeded "Series.Code"-column  
-- Rename the "Score.2015"-column to the name of the Scale  
-- Free memory by deleting the old pisadata_dirty frame


```{r eval=TRUE, echo=TRUE}
pisadata_clean <- tidyr::spread(pisadata_dirty, Series.Name, Score.2015)
pisadata_clean
```

```{r eval=TRUE, echo=TRUE}
pisadata_dirty <- NULL
```

###Clean data

-- Delete all rows with countries that have not participated in the PISA study
-- Free memory by deleting the old Scale-Dataframes

```{r eval=TRUE, echo=TRUE}
pisadata_clean <- subset(pisadata_clean, pisadata_clean[2] != ".." | pisadata_clean[3] != ".." | pisadata_clean[4] != ".." | pisadata_clean[5] != ".." | pisadata_clean[6] != ".." | pisadata_clean[7] != ".." | pisadata_clean[8] != ".." | pisadata_clean[9] != ".." | pisadata_clean[10] != "..")

pisadata_clean
```

### Save Data in CSV-File

-- Write the clean PISA-Data to a CSV-File

```{r eval=TRUE, echo=TRUE}
write.csv(pisadata_clean, file = "../data/clean_data/pisa_data.csv",row.names=FALSE, na="", col.names = TRUE)
```