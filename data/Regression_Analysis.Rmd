---
title: "Regression Analysis"
output:
  html_document:
    fig_width: 10
    fig_height: 10
    df_print: paged
    keep_md: yes
    toc: yes
---
> rmarkdown::render('../IT_Project/data/Regression_Analysis.Rmd', output_format = 'html_document')

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Setup

### Load Libraries 

-- Load Library for reading CSV Files.
-- Load tidyr-library
-- Load dplyr-library

```{r eval=FALSE, echo=TRUE}
library(csvread)
library(dplyr)
library(ggplot2)
library(corrplot)
library(knitr)
```
### Read data

```{r eval=FALSE, echo=TRUE}

data <- read.csv("../data/master_data/master_data.csv")
data
```

-- Select relevant columns for correlation

```{r eval=TRUE, echo=TRUE}
corr_data <- dplyr::select(data, Country, Happiness.Score, Economy.GDP.per.Capita, Family, Health.Life.Expectancy,Freedom, Trust.Government.Corruption, Generosity, Dystopia.Residual,Alcohol.Consumption.All.Types,Beer, Wine, Spirits, contains("PISA"))

corr_data

```

-- Perform Correlation

```{r eval=TRUE, echo=TRUE}

summary(cor(corr_data[,2:17]))
corrplot(cor(corr_data[,2:17]))


```

Interpretation



```{r eval=TRUE, echo=TRUE}

pisa.alcohol.lm <- lm(PISA.Performance.Mean ~Beer + Wine+ Spirits+Other, data)
summary(pisa.alcohol.lm)

pisa.alcohol2.lm <- lm(PISA.Performance.Mean ~Alcohol.Consumption.All.Types, data)
summary(pisa.alcohol2.lm)


pisa.happiness.lm <- lm(PISA.Performance.Mean~Happiness.Score, data)
summary(pisa.happiness.lm)

happiness.alcohol.lm<-lm(Happiness.Score ~ Alcohol.Consumption.All.Types, data)
summary(happiness.alcohol.lm)

pisa.economy.lm <- lm(PISA.Performance.Mean ~ Economy.GDP.per.Capita , data)
summary(pisa.economy.lm)


```

Interpretation:

High levels of significance point to positive relationships between our chosen variables:

-- Different kinds of alcohol (Beer, Wine and Others especially) are significant predictor variables for the average PISA performance.
-- Alcohol consumption in general is a significant predictor variable for the average PISA performance.
-- The Happiness Score is a significant predictor for the average PISA performance.

However one has to consider the low levels of R-square in all of the aforementioned regressions. This means that, although the low P values indicate a real relationship between predictors and response variables, the precision of the prediction is not very high on all accounts.
This can be led to the fact, that our data is very processed, on the one hand Happiness Score being a highly calculated variable and on the other having average scores for entire countries, rather than single oberservation variables. 


Lack of significance for the relationship between Happiness Score and Alcohol Consumption. 




```{r eval=TRUE, echo=TRUE}

plotRegression <- function(para){
  ggplot(para$model, aes_string(x=names(para$model)[2], y=names(para$model)[1]))+
    geom_point(shape=1, size=3, color="#DF01A5")+
    stat_smooth(method="lm", col="blue")+
    labs(title=paste("R2=", signif(summary(para)$r.squared,5),
                     "Intercept=", signif(para$coef[[1]],5),
                     "Slope=", signif(para$coef[[2]],5),
                     "P=",signif(summary(para)$coef[2,4],5)))
}

plot1<-plotRegression(lm(Happiness.Score~Alcohol.Consumption.All.Types, data))

plot3<-plotRegression(lm(PISA.Performance.Mean~Alcohol.Consumption.All.Types, data))
plot6<-plotRegression(lm(PISA.Performance.Mean~Happiness.Score, data))

plot1
plot3
plot6
```

